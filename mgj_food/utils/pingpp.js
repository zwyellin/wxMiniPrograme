!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pingpp=e()}}(function(){return function a(o,l,c){function u(n,e){if(!l[n]){if(!o[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(s)return s(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var i=l[n]={exports:{}};o[n][0].call(i.exports,function(e){return u(o[n][1][e]||e)},i,i.exports,a,o,l,c)}return l[n].exports}for(var s="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,n,t){var r=e('./payment_elements.js');n.exports={userCallback:void 0,urlReturnCallback:void 0,urlReturnChannels:['alipay_pc_direct'],innerCallback:function(e,n){'function'==typeof this.userCallback&&(void 0===n&&(n=this.error()),this.userCallback(e,n),this.userCallback=void 0,r.clear())},error:function(e,n){return{msg:e=void 0===e?'':e,extra:n=void 0===n?'':n}},triggerUrlReturnCallback:function(e,n){'function'==typeof this.urlReturnCallback&&this.urlReturnCallback(e,n)},shouldReturnUrlByCallback:function(e){return'function'==typeof this.urlReturnCallback&&-1!==this.urlReturnChannels.indexOf(e)}}},{"./payment_elements.js":8}],2:[function(e,n,t){var i=e('../stash'),a=e('../callbacks'),o={}.hasOwnProperty;n.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){for(var n=e.credential[e.channel],t=['appId','timeStamp','nonceStr','package','signType','paySign'],r=0;r<t.length;r++)if(!o.call(n,t[r]))return void a.innerCallback('fail',a.error('invalid_credential','missing_field_'+t[r]));i.jsApiParameters=n,this.callpay()},wxLiteEnabled:function(){return'undefined'!=typeof wx&&wx.requestPayment},callpay:function(){if(this.wxLiteEnabled()){var e=i.jsApiParameters;delete e.appId,e.complete=function(e){'requestPayment:ok'===e.errMsg&&a.innerCallback('success'),'requestPayment:cancel'===e.errMsg&&a.innerCallback('cancel',a.error('用户取消支付')),'undefined'!==e.err_code&&'undefined'!==e.err_desc&&a.innerCallback('fail',a.error(e.err_desc,e))},wx.requestPayment(e)}else console.log('请在微信小程序中打开')},runTestMode:function(e){var n='/charges/'+e.id;wx.request({url:this.PINGPP_NOTIFY_URL_BASE+n+'?livemode=false',success:function(e){'success'==e.data?a.innerCallback('success'):a.innerCallback('fail',a.error('testmode_notify_fail'))},fail:function(){a.innerCallback('fail',a.error('network_err'))}})}}},{"../callbacks":1,"../stash":9}],3:[function(e,n,t){var o=e('./utils'),i=e('./stash'),l=e('./libs/md5'),r={seperator:'###',limit:1,report_url:'https://statistics.pingxx.com/one_stats',timeout:100},c=function(e,n){var t=new RegExp('(^|&)'+n+'=([^&]*)(&|$)','i'),r=e.substr(0).match(t);return null!==r?unescape(r[2]):null};r.store=function(e){if('undefined'!=typeof localStorage&&null!==localStorage){var n={};n.app_id=e.app_id||i.app_id||'app_not_defined',n.ch_id=e.ch_id||'',n.channel=e.channel||'',n.type=e.type||'',n.user_agent=navigator.userAgent,n.host=window.location.host,n.time=(new Date).getTime(),n.puid=i.puid;var t='app_id='+n.app_id+'&channel='+n.channel+'&ch_id='+n.ch_id+'&host='+n.host+'&time='+n.time+'&type='+n.type+'&user_agent='+n.user_agent+'&puid='+n.puid,r=t;null!==localStorage.getItem('PPP_ONE_STATS')&&0!==localStorage.getItem('PPP_ONE_STATS').length&&(r=localStorage.getItem('PPP_ONE_STATS')+this.seperator+t);try{localStorage.setItem('PPP_ONE_STATS',r)}catch(e){}}},r.send=function(){if('undefined'!=typeof localStorage&&null!==localStorage){var e=this,n=localStorage.getItem('PPP_ONE_STATS');if(!(null===n||n.split(e.seperator).length<e.limit))try{for(var t=[],r=n.split(e.seperator),i=l(r.join('&')),a=0;a<r.length;a++)t.push({app_id:c(r[a],'app_id'),channel:c(r[a],'channel'),ch_id:c(r[a],'ch_id'),host:c(r[a],'host'),time:c(r[a],'time'),type:c(r[a],'type'),user_agent:c(r[a],'user_agent'),puid:c(r[a],'puid')});o.request(e.report_url,'POST',t,function(e,n){200==n&&localStorage.removeItem('PPP_ONE_STATS')},void 0,{'X-Pingpp-Report-Token':i})}catch(e){}}},r.report=function(e){var n=this;n.store(e),setTimeout(function(){n.send()},n.timeout)},n.exports=r},{"./libs/md5":5,"./stash":9,"./utils":11}],4:[function(e,n,t){var r=e('./stash'),i=e('./utils'),a=e('./collection');n.exports={SRC_URL:'https://cookie.pingxx.com',init:function(){var e=this;i.documentReady(function(){try{e.initPuid()}catch(e){}})},initPuid:function(){if('undefined'!=typeof window&&'undefined'!=typeof localStorage&&null!==localStorage){var e=localStorage.getItem('pingpp_uid');if(null===e){e=i.randomString();try{localStorage.setItem('pingpp_uid',e)}catch(e){}}if(r.puid=e,!document.getElementById('p_analyse_iframe')){var n;try{n=document.createElement('iframe')}catch(e){n=document.createElement('<iframe name="ifr"></iframe>')}n.id='p_analyse_iframe',n.src=this.SRC_URL+'/?puid='+e,n.style.display='none',document.body.appendChild(n)}setTimeout(function(){a.send()},0)}}}},{"./collection":3,"./stash":9,"./utils":11}],5:[function(e,n,t){!function(){function d(e,n){var t=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(t>>16)<<16|65535&t}function l(e,n,t,r,i,a){return d((o=d(d(n,e),d(r,a)))<<(l=i)|o>>>32-l,t);var o,l}function f(e,n,t,r,i,a,o){return l(n&t|~n&r,e,n,i,a,o)}function p(e,n,t,r,i,a,o){return l(n&r|t&~r,e,n,i,a,o)}function h(e,n,t,r,i,a,o){return l(n^t^r,e,n,i,a,o)}function m(e,n,t,r,i,a,o){return l(t^(n|~r),e,n,i,a,o)}function c(e,n){var t,r,i,a,o;e[n>>5]|=128<<n%32,e[14+(n+64>>>9<<4)]=n;var l=1732584193,c=-271733879,u=-1732584194,s=271733878;for(t=0;t<e.length;t+=16)c=m(c=m(c=m(c=m(c=h(c=h(c=h(c=h(c=p(c=p(c=p(c=p(c=f(c=f(c=f(c=f(i=c,u=f(a=u,s=f(o=s,l=f(r=l,c,u,s,e[t],7,-680876936),c,u,e[t+1],12,-389564586),l,c,e[t+2],17,606105819),s,l,e[t+3],22,-1044525330),u=f(u,s=f(s,l=f(l,c,u,s,e[t+4],7,-176418897),c,u,e[t+5],12,1200080426),l,c,e[t+6],17,-1473231341),s,l,e[t+7],22,-45705983),u=f(u,s=f(s,l=f(l,c,u,s,e[t+8],7,1770035416),c,u,e[t+9],12,-1958414417),l,c,e[t+10],17,-42063),s,l,e[t+11],22,-1990404162),u=f(u,s=f(s,l=f(l,c,u,s,e[t+12],7,1804603682),c,u,e[t+13],12,-40341101),l,c,e[t+14],17,-1502002290),s,l,e[t+15],22,1236535329),u=p(u,s=p(s,l=p(l,c,u,s,e[t+1],5,-165796510),c,u,e[t+6],9,-1069501632),l,c,e[t+11],14,643717713),s,l,e[t],20,-373897302),u=p(u,s=p(s,l=p(l,c,u,s,e[t+5],5,-701558691),c,u,e[t+10],9,38016083),l,c,e[t+15],14,-660478335),s,l,e[t+4],20,-405537848),u=p(u,s=p(s,l=p(l,c,u,s,e[t+9],5,568446438),c,u,e[t+14],9,-1019803690),l,c,e[t+3],14,-187363961),s,l,e[t+8],20,1163531501),u=p(u,s=p(s,l=p(l,c,u,s,e[t+13],5,-1444681467),c,u,e[t+2],9,-51403784),l,c,e[t+7],14,1735328473),s,l,e[t+12],20,-1926607734),u=h(u,s=h(s,l=h(l,c,u,s,e[t+5],4,-378558),c,u,e[t+8],11,-2022574463),l,c,e[t+11],16,1839030562),s,l,e[t+14],23,-35309556),u=h(u,s=h(s,l=h(l,c,u,s,e[t+1],4,-1530992060),c,u,e[t+4],11,1272893353),l,c,e[t+7],16,-155497632),s,l,e[t+10],23,-1094730640),u=h(u,s=h(s,l=h(l,c,u,s,e[t+13],4,681279174),c,u,e[t],11,-358537222),l,c,e[t+3],16,-722521979),s,l,e[t+6],23,76029189),u=h(u,s=h(s,l=h(l,c,u,s,e[t+9],4,-640364487),c,u,e[t+12],11,-421815835),l,c,e[t+15],16,530742520),s,l,e[t+2],23,-995338651),u=m(u,s=m(s,l=m(l,c,u,s,e[t],6,-198630844),c,u,e[t+7],10,1126891415),l,c,e[t+14],15,-1416354905),s,l,e[t+5],21,-57434055),u=m(u,s=m(s,l=m(l,c,u,s,e[t+12],6,1700485571),c,u,e[t+3],10,-1894986606),l,c,e[t+10],15,-1051523),s,l,e[t+1],21,-2054922799),u=m(u,s=m(s,l=m(l,c,u,s,e[t+8],6,1873313359),c,u,e[t+15],10,-30611744),l,c,e[t+6],15,-1560198380),s,l,e[t+13],21,1309151649),u=m(u,s=m(s,l=m(l,c,u,s,e[t+4],6,-145523070),c,u,e[t+11],10,-1120210379),l,c,e[t+2],15,718787259),s,l,e[t+9],21,-343485551),l=d(l,r),c=d(c,i),u=d(u,a),s=d(s,o);return[l,c,u,s]}function u(e){var n,t='';for(n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function s(e){var n,t=[];for(t[(e.length>>2)-1]=void 0,n=0;n<t.length;n+=1)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function r(e){var n,t,r='0123456789abcdef',i='';for(t=0;t<e.length;t+=1)n=e.charCodeAt(t),i+=r.charAt(n>>>4&15)+r.charAt(15&n);return i}function t(e){return unescape(encodeURIComponent(e))}function i(e){return u(c(s(n=t(e)),8*n.length));var n}function a(e,n){return function(e,n){var t,r,i=s(e),a=[],o=[];for(a[15]=o[15]=void 0,16<i.length&&(i=c(i,8*e.length)),t=0;t<16;t+=1)a[t]=909522486^i[t],o[t]=1549556828^i[t];return r=c(a.concat(s(n)),512+8*n.length),u(c(o.concat(r),640))}(t(e),t(n))}n.exports=function(e,n,t){return n?t?a(n,e):r(a(n,e)):t?i(e):r(i(e))}}()},{}],6:[function(e,n,t){var r=e('./version').v,o={}.hasOwnProperty,PingppSDK=function(){e('./init').init()};PingppSDK.prototype.version=r,n.exports=new PingppSDK;var l=e('./testmode'),c=e('./callbacks'),u=e('./mods'),s=e('./stash'),d=e('./collection'),f=e('./payment_elements');PingppSDK.prototype.createPayment=function(e,n,t,r){if('function'==typeof n&&(c.userCallback=n),f.init(e),o.call(f,'id'))if(o.call(f,'channel')){o.call(f,'app')&&('string'==typeof f.app?s.app_id=f.app:'object'==typeof f.app&&'string'==typeof f.app.id&&(s.app_id=f.app.id)),d.report({type:s.type||'pure_sdk_click',channel:f.channel,ch_id:f.id});var i=f.channel;if(o.call(f,'credential'))if(f.credential)if(o.call(f.credential,i))if(o.call(f,'livemode')){var a=u.getChannelModule(i);if(void 0===a)return console.error('channel module "'+i+'" is undefined'),void c.innerCallback('fail',c.error('invalid_channel','channel module "'+i+'" is undefined'));!1!==f.livemode?(void 0!==t&&(s.signature=t),'boolean'==typeof r&&(s.debug=r),a.handleCharge(f)):o.call(a,'runTestMode')?a.runTestMode(f):l.runTestMode(f)}else c.innerCallback('fail',c.error('invalid_charge','no_livemode_field'));else c.innerCallback('fail',c.error('invalid_credential','credential_is_incorrect'));else c.innerCallback('fail',c.error('invalid_credential','credential_is_undefined'));else c.innerCallback('fail',c.error('invalid_charge','no_credential'))}else c.innerCallback('fail',c.error('invalid_charge','no_channel'));else c.innerCallback('fail',c.error('invalid_charge','no_charge_id'))},PingppSDK.prototype.setAPURL=function(e){s.APURL=e},PingppSDK.prototype.setUrlReturnCallback=function(e,n){if('function'!=typeof e)throw'callback need to be a function';if(c.urlReturnCallback=e,void 0!==n){if(!Array.isArray(n))throw'channels need to be an array';c.urlReturnChannels=n}}},{"./callbacks":1,"./collection":3,"./init":4,"./mods":7,"./payment_elements":8,"./stash":9,"./testmode":10,"./version":12}],7:[function(e,n,t){var r={}.hasOwnProperty,i={};(n.exports=i).channels={wx_lite:e('./channels/wx_lite')},i.extras={},i.getChannelModule=function(e){if(r.call(i.channels,e))return i.channels[e]},i.getExtraModule=function(e){if(r.call(i.extras,e))return i.extras[e]}},{"./channels/wx_lite":2}],8:[function(e,n,t){var a=e('./callbacks'),o={}.hasOwnProperty;n.exports={id:null,or_id:null,channel:null,app:null,credential:{},extra:null,livemode:null,order_no:null,time_expire:null,init:function(e){var n;if('string'==typeof e)try{n=JSON.parse(e)}catch(e){return void a.innerCallback('fail',a.error('json_decode_fail',e))}else n=e;if(void 0!==n){if(o.call(n,'object')&&'order'==n.object){n.or_id=n.id,n.order_no=n.merchant_order_no;var t=n.charge_essentials;if(n.channel=t.channel,n.credential=t.credential,n.extra=t.extra,o.call(n,'charge')&&null!=n.charge)n.id=n.charge;else if(o.call(t,'id')&&null!=t.id)n.id=t.id;else if(o.call(n,'charges'))for(var r=0;r<n.charges.data.length;r++)if(n.charges.data[r].channel===t.channel){n.id=n.charges.data[r].id;break}}else o.call(n,'object')&&'recharge'==n.object&&(n=n.charge);for(var i in this)o.call(n,i)&&(this[i]=n[i]);return this}a.innerCallback('fail',a.error('json_decode_fail'))},clear:function(){for(var e in this)'function'!=typeof this[e]&&(this[e]=null)}}},{"./callbacks":1}],9:[function(e,n,t){n.exports={}},{}],10:[function(e,n,t){var r=e('./utils'),i={}.hasOwnProperty;n.exports={PINGPP_MOCK_URL:'http://sissi.pingxx.com/mock.php',runTestMode:function(e){var n={ch_id:e.id,scheme:'http',channel:e.channel};i.call(e,'order_no')?n.order_no=e.order_no:i.call(e,'orderNo')&&(n.order_no=e.orderNo),i.call(e,'time_expire')?n.time_expire=e.time_expire:i.call(e,'timeExpire')&&(n.time_expire=e.timeExpire),i.call(e,'extra')&&(n.extra=encodeURIComponent(JSON.stringify(e.extra))),r.redirectTo(this.PINGPP_MOCK_URL+'?'+r.stringifyData(n),e.channel)}}},{"./utils":11}],11:[function(e,n,t){var r=e('./callbacks'),c={}.hasOwnProperty,u=n.exports={stringifyData:function(e,n,t){void 0===t&&(t=!1);var r=[];for(var i in e)c.call(e,i)&&'function'!=typeof e[i]&&('bfb_wap'==n&&'url'==i||'yeepay_wap'==n&&'mode'==i||'channel_url'!=i&&r.push(i+'='+(t?encodeURIComponent(e[i]):e[i])));return r.join('&')},request:function(e,n,t,r,i,a){if('undefined'!=typeof XMLHttpRequest){var o=new XMLHttpRequest;if(void 0!==o.timeout&&(o.timeout=6e3),'GET'===(n=n.toUpperCase())&&'object'==typeof t&&t&&(e+='?'+u.stringifyData(t,'',!0)),o.open(n,e,!0),void 0!==a)for(var l in a)c.call(a,l)&&o.setRequestHeader(l,a[l]);'POST'===n?(o.setRequestHeader('Content-type','application/json; charset=utf-8'),o.send(JSON.stringify(t))):o.send(),void 0===r&&(r=function(){}),void 0===i&&(i=function(){}),o.onreadystatechange=function(){4==o.readyState&&r(o.responseText,o.status,o)},o.onerror=function(e){i(o,0,e)}}else console.log('Function XMLHttpRequest is undefined.')},formSubmit:function(e,n,t){if('undefined'!=typeof window){var r=document.createElement('form');for(var i in r.setAttribute('method',n),r.setAttribute('action',e),t)if(c.call(t,i)){var a=document.createElement('input');a.setAttribute('type','hidden'),a.setAttribute('name',i),a.setAttribute('value',t[i]),r.appendChild(a)}document.body.appendChild(r),r.submit()}else console.log('Not a browser, form submit url: '+e)},randomString:function(e){void 0===e&&(e=32);for(var n='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',t=n.length,r='',i=0;i<e;i++)r+=n.charAt(Math.floor(Math.random()*t));return r},redirectTo:function(e,n){r.shouldReturnUrlByCallback(n)?r.triggerUrlReturnCallback(null,e):'undefined'!=typeof window?window.location.href=e:console.log('Not a browser, redirect url: '+e)},inWeixin:function(){return'undefined'!=typeof navigator&&-1!==navigator.userAgent.toLowerCase().indexOf('micromessenger')},inAlipay:function(){return'undefined'!=typeof navigator&&-1!==navigator.userAgent.toLowerCase().indexOf('alipayclient')},documentReady:function(e){'undefined'!=typeof document?'loading'!=document.readyState?e():document.addEventListener('DOMContentLoaded',e):e()},loadUrlJs:function(e,n,t){var r=document.getElementsByTagName('head')[0],i=null;null==document.getElementById(e)?((i=document.createElement('script')).setAttribute('type','text/javascript'),i.setAttribute('src',n),i.setAttribute('id',e),i.async=!0,null!=t&&(i.onload=i.onreadystatechange=function(){if(i.ready)return!1;i.readyState&&'loaded'!=i.readyState&&'complete'!=i.readyState||(i.ready=!0,t())}),r.appendChild(i)):null!=t&&t()}}},{"./callbacks":1}],12:[function(e,n,t){n.exports={v:'2.2.2'}},{}]},{},[6])(6)});
//# sourceMappingURL=pingpp.js.map
